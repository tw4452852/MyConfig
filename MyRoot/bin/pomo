#!/home/tw/code/plan9port/bin/rc

. 9.rc
. $PLAN9/lib/acme.rc

stop=false

fn event {
	# $1 - c1 origin of event
	# $2 - c2 type of action
	# $3 - q0 beginning of selection
	# $4 - q1 end of selection
	# $5 - eq0 beginning of expanded selection
	# $6 - eq1 end of expanded selection
	# $7 - flag
	# $8 - nr number of runes in $9
	# $9 - text
	# $10 - chorded argument
	# $11 - origin of chorded argument

	switch($1$2){
	case E*	# write to body or tag
	case F*	# generated by ourselves; ignore
	case K*	# type away we do not care
	case Mi	# mouse: text inserted in tag
	case MI	# mouse: text inserted in body
	case Md	# mouse: text deleted from tag
	case MD	# mouse: text deleted from body
	case Ml ML	# button 3 in tag or body

	case Mx MX	# button 2 in tag or body
		switch($9) {
		case reset
			zpomo reset
		case pause
			zpomo toggle
		case *
			winwriteevent $*
		}
	}
}

newwindow
winname pomoclock

wineventloop &

while() {
	cmd=' pause reset |'
	date=`{9 date| u tr -d '\n'}
	status=`{zpomo status}

	line=($cmd  $status $date)
	winctl cleartag >[2]/dev/null || exit 0
	printf $"line | winwrite tag >[2]/dev/null|| exit 0

	sleep 1
}
